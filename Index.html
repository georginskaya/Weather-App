<!-- Notes: 
/ aligh C and F 
Find how to use version control on vs code-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=PT+Mono&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arvo:wght@700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arvo:wght@700&family=Poppins:wght@300&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=PT+Mono&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous" />
    <script src="https://kit.fontawesome.com/90682e38de.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>


    <div class="container header">
        <div class="headingAll">
            <form id="search">
                <div class="row">
                    <div class="col-5">
                        <h1 class="heading">Wheather App</h1>
                        <div class="date">Date</div>
                    </div>

                    <div class="col-3">

                        <input type="text" placeholder="Search for a city" autocomplete="off" autofocus="on"
                            id="search-input" />
                        <!-- give an id to a value inside the input tto have access to it  -->

                    </div>
                    <div class="col-2">
                        <input type="submit" value="Search" class="weatherbutton" id="weatherButton" />
                        <button type="button" class="current" id="current-location">Here</button>
                    </div>
                    <div class="col-2">

                    </div>
            </form>

        </div>
    </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-5">
                <div class="forecast">

                    <h2 id="city">City Name</h2>
                    <div id="temperature-description">Description</div>
                    <!-- STOLEN piece of code -->
                    <div class="placeholder1">
                        <div class="clearfix weather-temperature">
                            <img src="#" alt="weather icon" id="weather-icon" class="weather-icon float-left" />
                            <div class="float-left">
                                <span class="temperature" id="temperature">19</span><span class="units">
                                    <a href="#" id="celsius-link" class="active">째C</a> |
                                    <a href="#" id="fahrenheit-link" class="active">째F</a>
                                </span>
                            </div>
                        </div>
                    </div>
                    <ul>

                        <li>Humidity: <span id="humidity"></span>%</li>
                        <li>Wind: <span id="wind"></span> km/h</li>
                    </ul>
                </div>
            </div>
            <div class="col-7">
                <img class="keyvisual" src="src/undraw_Powerful_re_frhr.svg" />
            </div>
        </div>
    </div>

    <div class="container low-container">

        <div class="weekly" id="weeklyForecast">


        </div><br> <br><br>
        <div class="credits"><a href="https://github.com/georginskaya/weather" target="_blank">Open-source code
                by</a> Alyona</div>

    </div>


    <script>


        let now = new Date();


        function formatDate(mydate) {
            let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            let day = days[mydate.getDay()]; //  returns a value between 0 and 6
            //   inside the [] is a value (index) that .getDay is returning

            let months = [
                "Jan",
                "Feb",
                "Mar",
                "Apr",
                "May",
                "Jun",
                "Jul",
                "Aug",
                "Sep",
                "Oct",
                "Nov",
                "Dec",
            ];
            let month = months[mydate.getMonth()];

            let date = mydate.getDate();
            let hour = mydate.getHours();
            if (hour < 10) {
                hour = `0${hour}`
            }
            let minute = mydate.getMinutes();
            if (minute < 10) {
                minute = `0${minute}`
            }
            let year = mydate.getFullYear();

            let formattedDate = document.querySelector(".date");
            formattedDate.innerHTML = `${day} ${month} ${date}, ${year} | ${hour}:${minute}`;

            return formattedDate;
        }

        //   here you are starting the function by sending the "now" as a "my date" parameter
        formatDate(now);







        // SEARCH FUNCTION

        //  targetting search button
        let form = document.querySelector("#search");
        form.addEventListener("submit", search);

        function search(event) {
            // with preventDefault it is not going to reload the page
            event.preventDefault();
            //     THIS  is where u r storing the value in the console
            let searchInput = document.querySelector("#search-input");

            let h2 = document.querySelector("h2");
            if (searchInput.value) {
                h2.innerHTML = `${searchInput.value}`;
            } else {
                alert("Please type smth");
            }
        }




        // Format days for forecast 
        // timestamp is sent here from the "forecastDay.dt" - see below - then the function
        // takes this timestamp and does the calculation, dfines the current date and goes through an array


        function formatForecastDays(timestamp) {
            let date = new Date(timestamp * 1000);
            let day = date.getDay();
            let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            return days[day];
        }



        // API
        // displaying weekly forecast here - manipulate html with js 
        function displayForecast(response) {
            let forecastDays = response.data.daily;
            let forecastElement = document.querySelector("#weeklyForecast");


            let forecastHTML = `<div class="row">`;
            // Looping through days from daily forecast
            forecastDays.forEach(function (forecastDay, index) {



                if (index < 6) {

                    forecastHTML = forecastHTML + `
                
                <div class="col">
                    <div class="forecast-date">${formatForecastDays(forecastDay.dt)}</div>
                  
                    <img src = "http://openweathermap.org/img/wn/${forecastDay.weather[0].icon}@2x.png");width="42" />
                    <div class="forecast-temperatures">
                        <span class="forecast-temperature-max"> ${Math.round(forecastDay.temp.max)}째</span>
                         <span class="forecast-temperature-min"> ${Math.round(forecastDay.temp.min)}째</span>
                        </div>
                         </div>`;
                }
            });
            forecastHTML = forecastHTML + `</div>`;

            forecastElement.innerHTML = forecastHTML;


        }

        // Getting weekly forecast - making an api call
        function getForecast(coordinates) {

            let apiKey = "3980a7c8f2a782241a093131b099f993";
            apiUrl = `https://api.openweathermap.org/data/2.5/onecall?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=${apiKey}&units=metric`;


            axios.get(apiUrl).then(displayForecast);


        }





        function displayWeather(response) {

            celsiusTemperature = response.data.main.temp;


            document.querySelector("#city").innerHTML = response.data.name;
            document.querySelector("#temperature").innerHTML = Math.round(
                response.data.main.temp
            );
            document.querySelector("#temperature-description").innerHTML =
                response.data.weather[0].description;
            document.querySelector("#humidity").innerHTML =
                response.data.main.humidity

            document.querySelector("#wind").innerHTML =
                Math.round(response.data.wind.speed);

            // Getting weather icon
            let iconElement = document.querySelector("#weather-icon");
            iconElement.setAttribute("src", `http://openweathermap.org/img/wn/${response.data.weather[0].icon}@2x.png`);
            iconElement.setAttribute("alt", response.data.weather[0].description);
            // Changin  keyvisual 

            if (response.data.main.temp < -1) {
                let keyVisual = document.querySelector(".keyvisual");
                keyVisual.setAttribute("src", "src/undraw_Powerful_re_frhr.svg");
            }

            if (response.data.main.temp > 1) {
                let keyVisual = document.querySelector(".keyvisual");
                keyVisual.setAttribute("src", "src/undraw_My_universe_re_txot.svg");
            }

            if (response.data.main.temp > 9) {
                let keyVisual = document.querySelector(".keyvisual");
                keyVisual.setAttribute("src", "src/undraw_Hiking_re_k0bc.svg");
            }

            if (response.data.main.temp > 16) {
                let keyVisual = document.querySelector(".keyvisual");
                keyVisual.setAttribute("src", "src/undraw_Floating_re_xtcj.svg");
            }

            celsius.classList.add("active");
            fahrenheit.classList.remove("active");



            getForecast(response.data.coord);




        }

        function searchCity(city) {

            let apiKey = "3980a7c8f2a782241a093131b099f993";

            let apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

            axios.get(apiUrl).then(displayWeather);
            console.log(apiUrl);
        }


        // UNIT Conversion 
        //  VERIABLES FOR UNITS
        let temperature = document.querySelector("#temperature");


        let celsius = document.querySelector("#celsius-link");
        celsius.addEventListener("click", changetoCelsius);

        let fahrenheit = document.querySelector("#fahrenheit-link");
        fahrenheit.addEventListener("click", changetoFahrenheit);
        //  VERIABLES FOR UNITS END


        //  FUNCTIONS FOR UNITS
        function changetoCelsius(event) {
            event.preventDefault;
            celsius.classList.add("active");
            fahrenheit.classList.remove("active");

            temperature.innerHTML = Math.round(celsiusTemperature);
        }

        function changetoFahrenheit(event) {
            event.preventDefault;

            // remove the "active" class from the celsius link
            celsius.classList.remove("active");
            fahrenheit.classList.add("active");
            let farenheitTemp = (celsiusTemperature * 9 / 5) + 32;
            let temperature = document.querySelector("#temperature");
            temperature.innerHTML = Math.round(farenheitTemp);
        }


        //  getting current location

        function getCurrent(event) {
            event.preventDefault;
            navigator.geolocation.getCurrentPosition(searchLocation);
        }

        function searchLocation(position) {
            let apiKey = "3980a7c8f2a782241a093131b099f993";

            apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${position.coords.latitude}&lon=${position.coords.longitude}&appid=${apiKey}&units=metric`;
            axios.get(apiUrl).then(displayWeather);
        }

        function handleSubmit(event) {
            debugger;
            event.preventDefault();
            let city = document.querySelector("#search-input").value;
            searchCity(city);
        }

        let celsiusTemperature = null;

        let searchForm = document.querySelector("#search");
        searchForm.addEventListener("submit", handleSubmit);

        let currentLocation = document.querySelector("#current-location");
        currentLocation.addEventListener("click", getCurrent);

        searchCity("Suprunivka");






    </script>

</body>

</html>